<Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">

  <PropertyGroup>
    <TargetFramework>net6.0</TargetFramework>
    <WasmBuildNative>true</WasmBuildNative>
    <RunAotCompilation>true</RunAotCompilation>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks> 
    <EmccExtraLDFlags>-s WARN_ON_UNDEFINED_SYMBOLS=0</EmccExtraLDFlags>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly" Version="6.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.DevServer" Version="6.0.0" PrivateAssets="all" />
  </ItemGroup>

  <!-- Reference the StereoKit project, emulate how the NuGet behaves -->
  <ItemGroup>
    <ProjectReference Include="$(ProjectDir)..\..\..\StereoKit\StereoKit.csproj" />
    <!--<None CopyToOutputDirectory="PreserveNewest" Link="runtimes\browser-wasm\native\libStereoKitC.so"  Include="$(ProjectDir)../../../bin/distribute/bin/web/wasm32/$(Configuration)/libStereoKitC.so" />-->
    <!--<None CopyToOutputDirectory="PreserveNewest" Link="runtimes\wasm\native\StereoKitC.sym" Include="$(ProjectDir)../../../bin/distribute/bin/web/wasm32/$(Configuration)/libStereoKitC.sym" />-->
    <NativeFileReference Include="$(ProjectDir)../../../bin/distribute/bin/web/wasm32/$(Configuration)/libStereoKitC.a" />
    <!--<PackNativeLibrary Include="$(ProjectDir)../../../bin/distribute/bin/web/wasm32/$(Configuration)/libStereoKitC.a">
      <Link>runtimes/browser-wasm/native/libStereoKitC.a</Link>
    </PackNativeLibrary>-->
  </ItemGroup>
  <Import Project="$(ProjectDir)..\..\..\StereoKit\SKShaders.targets" />

  <ItemGroup>
    <Compile Include="..\*.cs" />
    <Compile Include="..\Demos\*.cs" />
    <Compile Include="..\Tools\*.cs" />
    <Compile Include="..\Tests\*.cs" />
    <Compile Include="..\Docs\*.cs" />
  </ItemGroup>

  <!-- Copy assets, and build the app's shaders into the final app folder -->
  <ItemGroup>
    <Content Include="..\..\Assets\**">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>Assets\%(RecursiveDir)%(Filename)%(Extension)</Link>
    </Content>
    <SKShader Include="..\..\Assets\**\*.hlsl" BuildRoot="..\..\" BuildTo="Assets" />
  </ItemGroup>

  <ItemGroup>
    <Folder Include="wwwroot\" />
  </ItemGroup>

  <Target Name="PreBuild" BeforeTargets="PreBuildEvent">
    <Exec Command="cd $(SolutionDir)&#xD;&#xA;xmake f -p wasm -y -m $(ConfigurationName)&#xD;&#xA;xmake" />
  </Target>

	<Target Name="StereoKitLibraries" BeforeTargets="BeforeBuild">
		<Message Importance="high" Text="[StereoKit NuGet] Framework: $(TargetFrameworkIdentifier), Platform: $(RuntimeIdentifier)" />
		<Message Importance="high" Text="[StereoKit NuGet] Emsdk: $(EMSDK_PATH)" />
	</Target>
</Project>

